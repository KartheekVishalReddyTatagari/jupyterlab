# name: DevSecOps Code Quality and Security Scan

# on:
#   push:
#     branches:
#       - main
#   pull_request:
#     types: [opened, synchronize, reopened]

# jobs:
#   build_and_scan:
#     name: Build, Install and SonarCloud Scan
#     runs-on: ubuntu-latest

#     steps:
#       - name: â¬‡ï¸ Checkout Code
#         uses: actions/checkout@v4
#         with:
#           # Crucial for SonarQube's deep analysis
#           fetch-depth: 0 

#       - name: âš™ï¸ Setup Node.js Environment
#         # Set up the JavaScript/TypeScript environment
#         uses: actions/setup-node@v4
#         with:
#           node-version: '20'

#       - name: ğŸ“¦ Install Project Dependencies
#         # Install packages before scanning
#         run: npm install --legacy-peer-deps --ignore-scripts

#       - name: ğŸ›¡ï¸ SonarCloud Analysis (DevSecOps Step)
#         # The mandatory security scan
#         uses: SonarSource/sonarcloud-github-action@v2
#         env:
#           GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
#           SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }} 



name: DevSecOps CI Pipeline for JupyterLab

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build_and_scan:
    name: Build and SonarCloud Scan
    runs-on: ubuntu-latest

    steps:
      - name: â¬‡ï¸ Checkout Code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ğŸ Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: âš™ï¸ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: ğŸ“¦ Install Node Dependencies
        run: npm install --legacy-peer-deps --ignore scripts

      - name: ğŸ—ï¸ Build JupyterLab
        run: npm run build || jlpm build

      - name: ğŸ›¡ï¸ SonarCloud Scan
        uses: SonarSource/sonarcloud-github-action@v2
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
